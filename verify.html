<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>SNT - Verification Page</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        body { margin: 0; padding: 0; background: #f0f2f5; font-family: 'Times New Roman', serif; display: flex; flex-direction: column; align-items: center; }
        
        .verify-header { background: #3b5998; color: white; width: 100%; text-align: center; padding: 15px 0; font-weight: bold; font-size: 20px; margin-bottom: 20px; }

        #certificate-container { display: flex; justify-content: center; padding: 20px; transform: scale(0.9); transform-origin: top; }
        
        #certificate { 
            width: 1150px; height: 750px; display: flex; position: relative;
            border: 12px solid #3b5998; box-sizing: border-box; background: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .sidebar { 
            width: 250px; background: #3b5998; color: white; 
            padding: 50px 25px; box-sizing: border-box;
        }
        .sidebar h3 { font-size: 22px; border-bottom: 2px solid white; padding-bottom: 10px; margin-bottom: 25px; }
        .sidebar ul { list-style: none; padding: 0; }
        .sidebar ul li { font-size: 15px; margin-bottom: 15px; font-weight: bold; }
        
        .main-content { flex: 1; padding: 40px 150px 40px 40px; text-align: center; position: relative; }
        
        #student-photo { 
            position: absolute; top: 60px; right: 20px; width: 135px; height: 165px; 
            border: 2px solid #000; object-fit: cover; 
        }

        .verified-stamp {
            position: absolute; top: 380px; right: 30px; border: 4px double #22c55e;
            color: #22c55e; padding: 10px; font-weight: bold; transform: rotate(-15deg);
            font-size: 18px; border-radius: 8px; text-transform: uppercase;
        }
        
        .title-main { font-size: 70px; color: #3b5998; letter-spacing: 4px; margin: 10px 0; font-weight: bold; }
        .student-name { font-size: 45px; font-weight: bold; border-bottom: 2px solid #000; display: inline-block; padding: 0 30px; text-transform: uppercase; margin: 15px 0; }
        
        .footer-info { position: absolute; bottom: 50px; width: 92%; display: flex; justify-content: space-between; align-items: flex-end; left: 30px; }
        .sig-box { text-align: center; width: 200px; }
        .sig-cursive { font-family: 'Dancing Script', cursive; font-size: 28px; color: #1a237e; height: 40px; }
        .sig-line { border-top: 1px solid #000; padding-top: 5px; font-weight: bold; font-size: 15px; }

        @media (max-width: 1200px) { #certificate-container { transform: scale(0.6); } }
        @media (max-width: 800px) { #certificate-container { transform: scale(0.4); } }
    </style>
</head>
<body>

    <div class="verify-header">✓ OFFICIAL VERIFICATION RECORD - SNT EDUCATION</div>

    <div id="certificate-container">
        <div id="certificate">
            <div class="sidebar">
                <h3>TOPIC COVERED</h3>
                <ul id="topic-list">
                    </ul>
            </div>
            <div class="main-content">
                <div style="text-align: left; display: flex; align-items: center;">
                    <img src="SNT.jpg" style="width: 80px; margin-right: 15px;">
                    <div style="font-weight: bold; font-size: 26px; color: #3b5998;">SNT EDUCATION</div>
                </div>
                
                <img id="student-photo" src="">

                <div class="title-main">VERIFIED</div>
                <p style="font-size: 24px; font-style: italic; margin: 5px 0;">Student Record Confirmation</p>
                <div class="student-name" id="disp-name">Loading...</div>
                
                <p style="font-size: 20px; margin-top: 10px;">successfully completed <b id="disp-course">...</b></p>
                <p style="font-size: 18px; font-weight: bold;" id="disp-duration">Duration: ---</p>
                
                <div class="verified-stamp">Verified Online</div>
                
                <div class="footer-info">
                    <div style="text-align:left; font-size:13px; font-weight:bold;">ISO 9001:2015 Certified<br>Verification ID: <span id="v-id"></span></div>
                    <div class="sig-box">
                        <div id="s1-name" class="sig-cursive"></div>
                        <div class="sig-line">Examining Authority</div>
                    </div>
                    <div class="sig-box">
                        <div id="s2-name" class="sig-cursive"></div>
                        <div class="sig-line">Managing Director</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyAOQtM_XYLqPgxMK1XBdfl0m7KoAseZRCA", 
            authDomain: "snt-computer-institute.firebaseapp.com", 
            databaseURL: "https://snt-computer-institute-default-rtdb.firebaseio.com/", 
            projectId: "snt-computer-institute" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');

        if (id) {
            document.getElementById('v-id').innerText = id;

            // 1. Fetch Student Identity
            db.ref('students').orderByChild('studentId').equalTo(id).once('value', snapshot => {
                if (snapshot.exists()) {
                    const student = Object.values(snapshot.val())[0];
                    document.getElementById('disp-name').innerText = student.name;
                    document.getElementById('student-photo').src = student.profilePicture || 'SNT.jpg';
                    document.getElementById('disp-course').innerText = student.course || (student.courses ? student.courses[0] : "Computer Course");
                } else {
                    alert("Record Not Found");
                }
            });

            // 2. Fetch Saved Certificate Data (Permanent Data)
            db.ref('certificates/' + id).once('value', snapshot => {
                if (snapshot.exists()) {
                    const cert = snapshot.val();
                    document.getElementById('s1-name').innerText = cert.n1 || '';
                    document.getElementById('s2-name').innerText = cert.n2 || '';
                    document.getElementById('disp-duration').innerText = `Duration: ${cert.startDate} to ${cert.endDate} | Grade: ${cert.grade}`;

                    // Load Topics
                    if (cert.topics) {
                        const list = document.getElementById('topic-list');
                        list.innerHTML = "";
                        cert.topics.split(',').forEach(topic => {
                            const li = document.createElement('li');
                            li.innerText = `• ${topic.trim().toUpperCase()}`;
                            list.appendChild(li);
                        });
                    }
                }
            });
        } else {
            document.body.innerHTML = "<h2 style='text-align:center; margin-top:50px;'>No ID Provided for Verification</h2>";
        }
    </script>
</body>
</html>
